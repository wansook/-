<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ìˆ˜í•™ í•™ìŠµì§€ ìƒì„±ê¸°</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Nanum+Gothic:wght@400;700;800&display=swap"
        rel="stylesheet" />
    <style>
        /* â”€â”€â”€ Reset & Variables â”€â”€â”€ */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        :root {
            --bg: #0f0f1a;
            --surface: #1a1a2e;
            --card: #16213e;
            --accent: #6c63ff;
            --accent3: #4cc9f0;
            --text: #e0e0ff;
            --muted: #8888aa;
            --border: #2a2a4a;
            --green: #06d6a0;

            /* A4 layout constants (mm) â€” used for JS calc too via CSS var */
            --a4-pad-v: 14;
            /* top+bottom padding each side (mm) */
            --a4-pad-h: 15;
            /* left+right padding each side (mm) */
            --header-h: 28;
            /* sheet header + info row area (mm)  */
            --row-h: 14;
            /* one problem row height incl. gap   (mm) */
            --cols: 3;
            /* grid columns */
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }

        /* â”€â”€â”€ Control Panel â”€â”€â”€ */
        .control-panel {
            background: linear-gradient(135deg, var(--surface) 0%, var(--card) 100%);
            border-bottom: 1px solid var(--border);
            padding: 20px 28px 18px;
            display: flex;
            flex-wrap: wrap;
            gap: 18px;
            align-items: flex-end;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(12px);
        }

        .panel-header {
            width: 100%;
            display: flex;
            align-items: baseline;
            gap: 14px;
            margin-bottom: 2px;
        }

        .panel-title {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(90deg, var(--accent), var(--accent3));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .panel-badge {
            font-size: 11px;
            color: var(--muted);
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .control-group label {
            font-size: 10px;
            font-weight: 700;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .control-group input[type="number"],
        .control-group input[type="text"] {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            color: var(--text);
            border-radius: 10px;
            padding: 7px 12px;
            font-size: 14px;
            font-family: inherit;
            width: 110px;
            outline: none;
            transition: border-color 0.2s;
        }

        .control-group input[type="text"] {
            width: 160px;
        }

        .control-group input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.15);
        }

        /* badge showing auto-calculated count */
        .per-page-badge {
            font-size: 11px;
            color: var(--accent3);
            background: rgba(76, 201, 240, 0.1);
            border: 1px solid rgba(76, 201, 240, 0.25);
            border-radius: 6px;
            padding: 3px 8px;
            white-space: nowrap;
            align-self: flex-end;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .checkbox-group label.group-label {
            font-size: 10px;
            font-weight: 700;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .checkbox-row {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid var(--border);
            border-radius: 7px;
            padding: 5px 9px;
            cursor: pointer;
            transition: all 0.15s;
            user-select: none;
        }

        .checkbox-item:hover {
            border-color: var(--accent);
            background: rgba(108, 99, 255, 0.1);
        }

        .checkbox-item input[type="checkbox"] {
            accent-color: var(--accent);
            width: 13px;
            height: 13px;
            cursor: pointer;
        }

        .checkbox-item span {
            font-size: 11px;
            color: var(--text);
            font-weight: 500;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 7px;
            padding: 9px 20px;
            border-radius: 11px;
            border: none;
            cursor: pointer;
            font-size: 13px;
            font-weight: 700;
            font-family: inherit;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent), #9b59b6);
            color: #fff;
            box-shadow: 0 4px 18px rgba(108, 99, 255, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(108, 99, 255, 0.5);
        }

        .btn-print {
            background: linear-gradient(135deg, var(--green), #00b894);
            color: #fff;
            box-shadow: 0 4px 18px rgba(6, 214, 160, 0.4);
        }

        .btn-print:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(6, 214, 160, 0.5);
        }

        .btn-actions {
            display: flex;
            gap: 8px;
            align-items: flex-end;
        }

        /* â”€â”€â”€ Preview Area â”€â”€â”€ */
        .preview-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 24px;
            padding: 32px 24px 48px;
            background: #0a0a12;
            min-height: calc(100vh - 140px);
        }

        /* â”€â”€â”€ A4 Sheet â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       Fixed 210mm Ã— 297mm. overflow:hidden keeps it exact.
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .a4-sheet {
            width: 210mm;
            height: 297mm;
            overflow: hidden;
            background: #fff;
            color: #111;
            border-radius: 3px;
            box-shadow: 0 6px 50px rgba(0, 0, 0, 0.65), 0 0 0 1px rgba(255, 255, 255, 0.04);
            padding: calc(var(--a4-pad-v) * 1mm) calc(var(--a4-pad-h) * 1mm);
            font-family: 'Nanum Gothic', 'Noto Sans KR', sans-serif;
            display: flex;
            flex-direction: column;
        }

        /* â”€â”€ Sheet Header â”€â”€ */
        .sheet-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            border-bottom: 2px solid #222;
            padding-bottom: 6px;
            margin-bottom: 8px;
            flex-shrink: 0;
        }

        .sheet-title {
            font-size: 18px;
            font-weight: 800;
            color: #111;
        }

        .sheet-meta {
            font-size: 10px;
            color: #555;
            text-align: right;
            line-height: 1.7;
        }

        .sheet-info-row {
            display: flex;
            gap: 20px;
            margin-bottom: 8px;
            font-size: 11px;
            color: #333;
            flex-shrink: 0;
        }

        .sheet-info-item {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .sheet-info-line {
            display: inline-block;
            width: 72px;
            border-bottom: 1px solid #666;
            margin-left: 3px;
        }

        /* â”€â”€ Problems Grid â”€â”€ */
        .problems-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px 10px;
            flex: 1;
            align-content: start;
        }

        .problem-item {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 7px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #fafafa;
            font-size: 18px;
            font-weight: 800;
            font-family: 'Nanum Gothic', sans-serif;
            height: calc(var(--row-h) * 1mm);
            /* fixed row height = 14mm */
            overflow: hidden;
        }

        .problem-num {
            font-size: 8px;
            color: #bbb;
            font-weight: 400;
            min-width: 16px;
            align-self: flex-start;
            padding-top: 1px;
            flex-shrink: 0;
        }

        .problem-expr {
            display: flex;
            align-items: center;
            gap: 4px;
            flex-wrap: nowrap;
            flex: 1;
            overflow: hidden;
        }

        .blank-box {
            display: inline-block;
            width: 32px;
            height: 28px;
            border: 2.5px solid #1a1a1a;
            border-radius: 3px;
            background: #fff;
            flex-shrink: 0;
        }

        .op-symbol {
            font-size: 18px;
            font-weight: 900;
            color: #222;
            line-height: 1;
            flex-shrink: 0;
        }

        .eq-symbol {
            font-size: 16px;
            color: #444;
            flex-shrink: 0;
        }

        .no-problems {
            grid-column: 1 / -1;
            text-align: center;
            color: #aaa;
            font-size: 13px;
            padding: 30px 0;
        }

        /* â”€â”€â”€ Print Styles â”€â”€â”€ */
        @media print {
            @page {
                size: A4;
                margin: 0;
            }

            body,
            html {
                background: white !important;
            }

            .control-panel {
                display: none !important;
            }

            .preview-area {
                padding: 0 !important;
                background: white !important;
                gap: 0 !important;
                min-height: unset;
                display: block !important;
            }

            .a4-sheet {
                box-shadow: none !important;
                border-radius: 0 !important;
                page-break-after: always;
                break-after: page;
            }

            .a4-sheet:last-child {
                page-break-after: avoid;
                break-after: avoid;
            }
        }
    </style>
</head>

<body>

    <!-- â”€â”€â”€ Control Panel â”€â”€â”€ -->
    <div class="control-panel">
        <div class="panel-header">
            <span class="panel-title">âœï¸ ìˆ˜í•™ í•™ìŠµì§€ ìƒì„±ê¸°</span>
            <span class="panel-badge">ì„¤ì • ë³€ê²½ ì‹œ ìë™ ì—…ë°ì´íŠ¸</span>
        </div>

        <!-- ìë¦¿ìˆ˜ -->
        <div class="control-group">
            <label>ì²« ë²ˆì§¸ ìˆ˜ ìë¦¿ìˆ˜</label>
            <input type="number" id="digits1" value="1" min="1" max="4" />
        </div>
        <div class="control-group">
            <label>ë‘ ë²ˆì§¸ ìˆ˜ ìë¦¿ìˆ˜</label>
            <input type="number" id="digits2" value="1" min="1" max="4" />
        </div>

        <!-- ì¥ ìˆ˜ -->
        <div class="control-group">
            <label>ì¥ ìˆ˜ (í˜ì´ì§€)</label>
            <input type="number" id="pageCount" value="1" min="1" max="20" />
        </div>

        <!-- ìë™ ê³„ì‚° í‘œì‹œ -->
        <div class="per-page-badge" id="per-page-info">ì¥ë‹¹ â€” ë¬¸ì œ</div>

        <!-- ìœ í˜• ì„ íƒ -->
        <div class="checkbox-group">
            <label class="group-label">ë¬¸ì œ ìœ í˜•</label>
            <div class="checkbox-row">
                <label class="checkbox-item"><input type="checkbox" id="t1" checked /><span>â–¡ + â–¢ = ?</span></label>
                <label class="checkbox-item"><input type="checkbox" id="t2" checked /><span>â–¡ + ? = â–¢</span></label>
                <label class="checkbox-item"><input type="checkbox" id="t3" checked /><span>? + â–¡ = â–¢</span></label>
                <label class="checkbox-item"><input type="checkbox" id="t4" checked /><span>â–¡ - â–¢ = ?</span></label>
                <label class="checkbox-item"><input type="checkbox" id="t5" checked /><span>â–¡ - ? = â–¢</span></label>
                <label class="checkbox-item"><input type="checkbox" id="t6" checked /><span>? - â–¡ = â–¢</span></label>
            </div>
        </div>

        <!-- í•™ìŠµì§€ ì œëª© -->
        <div class="control-group">
            <label>í•™ìŠµì§€ ì œëª©</label>
            <input type="text" id="sheetTitle" value="ë§ì…ˆÂ·ëº„ì…ˆ í•™ìŠµì§€" />
        </div>

        <!-- ì‹œì‘ ë²ˆí˜¸ -->
        <div class="control-group">
            <label>ì‹œì‘ ë²ˆí˜¸</label>
            <input type="number" id="sheetNoStart" value="1" min="1" max="999" />
        </div>

        <!-- ë²„íŠ¼ -->
        <div class="btn-actions">
            <button class="btn btn-primary" onclick="generateWorksheet()">ğŸ”„ ìƒˆë¡œ ìƒì„±</button>
            <button class="btn btn-print" onclick="window.print()">ğŸ–¨ï¸ í”„ë¦°íŠ¸</button>
        </div>
    </div>

    <!-- â”€â”€â”€ Preview Area â”€â”€â”€ -->
    <div class="preview-area" id="preview-area">
        <!-- A4 sheets injected here -->
    </div>

    <script>
        // â”€â”€â”€ Constants (match CSS vars) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const A4_H_MM = 297;
        const PAD_V_MM = 14;   // top + bottom padding (each)
        const HEADER_MM = 28;   // header + info-row height
        const ROW_H_MM = 14;   // one problem row height incl. gap
        const COLS = 3;

        // usable height for problems
        const AVAIL_MM = A4_H_MM - PAD_V_MM * 2 - HEADER_MM;  // 297-28-28=241
        const ROWS_PER_PAGE = Math.floor(AVAIL_MM / ROW_H_MM);   // ~17 rows
        const PROBLEMS_PER_PAGE = ROWS_PER_PAGE * COLS;           // ~51

        // â”€â”€â”€ Utilities â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function getVal(id) { return parseInt(document.getElementById(id).value) || 0; }

        function randN(digits) {
            const min = digits === 1 ? 1 : Math.pow(10, digits - 1);
            const max = Math.pow(10, digits) - 1;
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function shuffleArray(arr) {
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
        }

        // â”€â”€â”€ Problem Builder â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        /**
         * d2 ìë¦¿ìˆ˜ ë²”ìœ„ ì•ˆì—ì„œ bigì„ ë„˜ì§€ ì•ŠëŠ” ë¹¼ëŠ” ìˆ˜ë¥¼ ë°˜í™˜.
         * d2 ìë¦¿ìˆ˜ ìµœì†Ÿê°’ì´ bigë³´ë‹¤ í¬ë©´ 1~big ì‚¬ì´ë¡œ fallback.
         */
        function safeSubtrahend(big, d2) {
            const lo = d2 === 1 ? 1 : Math.pow(10, d2 - 1);
            const hi = Math.min(big, Math.pow(10, d2) - 1);
            if (lo > hi) return Math.floor(Math.random() * big) + 1;
            return Math.floor(Math.random() * (hi - lo + 1)) + lo;
        }

        function makeProblem(type, d1, d2) {
            const box = '<span class="blank-box"></span>';
            const plus = '<span class="op-symbol">+</span>';
            const minus = '<span class="op-symbol">âˆ’</span>';
            const eq = '<span class="eq-symbol">=</span>';

            switch (type) {
                /* â”€ ë§ì…ˆ â”€ */
                case 1: { // a + b = â–¡
                    const a = randN(d1), b = randN(d2);
                    return `${a} ${plus} ${b} ${eq} ${box}`;
                }
                case 2: { // a + â–¡ = sum
                    const a = randN(d1), b = randN(d2);
                    return `${a} ${plus} ${box} ${eq} ${a + b}`;
                }
                case 3: { // â–¡ + b = sum
                    const a = randN(d1), b = randN(d2);
                    return `${box} ${plus} ${b} ${eq} ${a + b}`;
                }
                /* â”€ ëº„ì…ˆ: í”¼ê°ìˆ˜ë¥¼ d1 ìë¦¿ìˆ˜ë¡œ ì§ì ‘ ìƒì„± â”€ */
                case 4: { // big - b = â–¡  (big = d1 ìë¦¿ìˆ˜)
                    const big = randN(d1);
                    const b = safeSubtrahend(big, d2);
                    return `${big} ${minus} ${b} ${eq} ${box}`;
                }
                case 5: { // big - â–¡ = result
                    const big = randN(d1);
                    const b = safeSubtrahend(big, d2);
                    return `${big} ${minus} ${box} ${eq} ${big - b}`;
                }
                case 6: { // â–¡ - b = result  (â–¡ = d1 ìë¦¿ìˆ˜)
                    const b = randN(d2);
                    const lo = Math.max(d1 === 1 ? 1 : Math.pow(10, d1 - 1), b);
                    const hi = Math.pow(10, d1) - 1;
                    const q = lo <= hi
                        ? Math.floor(Math.random() * (hi - lo + 1)) + lo
                        : b + 1;
                    return `${box} ${minus} ${b} ${eq} ${q - b}`;
                }
                default: {
                    const a = randN(d1), b = randN(d2);
                    return `${a} ${plus} ${b} ${eq} ${box}`;
                }
            }
        }

        // â”€â”€â”€ Build one A4 sheet DOM element â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function buildSheet(pageIndex, startProblemNum, count, enabled, d1, d2, title, sheetNo) {
            const sheet = document.createElement('div');
            sheet.className = 'a4-sheet';

            const now = new Date();
            const dateStr = `${now.getFullYear()}.${String(now.getMonth() + 1).padStart(2, '0')}.${String(now.getDate()).padStart(2, '0')}`;

            sheet.innerHTML = `
      <div class="sheet-header">
        <div class="sheet-title">${escHtml(title)}</div>
        <div class="sheet-meta">No. ${sheetNo + pageIndex}<br/>${dateStr}</div>
      </div>
      <div class="sheet-info-row">
        <div class="sheet-info-item">ì´ë¦„<span class="sheet-info-line"></span></div>
        <div class="sheet-info-item">ë‚ ì§œ<span class="sheet-info-line"></span></div>
        <div class="sheet-info-item">ì ìˆ˜<span class="sheet-info-line"></span></div>
      </div>
      <div class="problems-grid" id="grid-${pageIndex}"></div>
    `;

            const grid = sheet.querySelector(`#grid-${pageIndex}`);

            if (enabled.length === 0) {
                grid.innerHTML = '<div class="no-problems">ë¬¸ì œ ìœ í˜•ì„ í•˜ë‚˜ ì´ìƒ ì„ íƒí•˜ì„¸ìš”.</div>';
                return sheet;
            }

            // Generate count problems for this page
            const problems = [];
            for (let i = 0; i < count; i++) {
                problems.push({ type: enabled[i % enabled.length], html: '' });
            }
            shuffleArray(problems);

            problems.forEach((p, i) => {
                const expr = makeProblem(p.type, d1, d2);
                const item = document.createElement('div');
                item.className = 'problem-item';
                item.innerHTML = `<span class="problem-num">${startProblemNum + i}</span><div class="problem-expr">${expr}</div>`;
                grid.appendChild(item);
            });

            return sheet;
        }

        function escHtml(str) {
            return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        }

        // â”€â”€â”€ Main Generate â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function generateWorksheet() {
            const d1 = Math.max(1, getVal('digits1'));
            const d2 = Math.max(1, getVal('digits2'));
            const pages = Math.max(1, getVal('pageCount'));
            const sheetNo = Math.max(1, getVal('sheetNoStart'));
            const title = document.getElementById('sheetTitle').value || 'ìˆ˜í•™ í•™ìŠµì§€';

            const enabled = [];
            for (let i = 1; i <= 6; i++) {
                if (document.getElementById('t' + i).checked) enabled.push(i);
            }

            // Update badge
            document.getElementById('per-page-info').textContent =
                `ì¥ë‹¹ ${PROBLEMS_PER_PAGE}ë¬¸ì œ (${ROWS_PER_PAGE}í–‰ Ã— ${COLS}ì—´)`;

            // Clear preview
            const preview = document.getElementById('preview-area');
            preview.innerHTML = '';

            let problemCounter = 1;
            for (let p = 0; p < pages; p++) {
                const sheet = buildSheet(p, problemCounter, PROBLEMS_PER_PAGE, enabled, d1, d2, title, sheetNo);
                preview.appendChild(sheet);
                problemCounter += PROBLEMS_PER_PAGE;
            }
        }

        // â”€â”€â”€ Auto-regenerate on change â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        ['digits1', 'digits2', 'pageCount', 'sheetNoStart', 'sheetTitle'].forEach(id => {
            document.getElementById(id).addEventListener('input', generateWorksheet);
        });
        for (let i = 1; i <= 6; i++) {
            document.getElementById('t' + i).addEventListener('change', generateWorksheet);
        }

        // â”€â”€â”€ Initial load â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        generateWorksheet();
    </script>
</body>

</html>