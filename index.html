<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ìˆ˜í•™ í•™ìŠµì§€ ìƒì„±ê¸°</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Nanum+Gothic:wght@400;700;800&display=swap"
        rel="stylesheet" />
    <style>
        /* â”€â”€â”€ Reset & Variables â”€â”€â”€ */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        :root {
            --bg: #0f0f1a;
            --surface: #1a1a2e;
            --card: #16213e;
            --accent: #6c63ff;
            --accent3: #4cc9f0;
            --accent-mul: #f7b731;
            --accent-mul2: #ff6b6b;
            --text: #e0e0ff;
            --muted: #8888aa;
            --border: #2a2a4a;
            --green: #06d6a0;

            --a4-pad-v: 14;
            --a4-pad-h: 15;
            --header-h: 28;
            --row-h: 14;
            --cols: 3;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }

        /* â”€â”€â”€ Tab Bar â”€â”€â”€ */
        .tab-bar {
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            display: flex;
            gap: 0;
            padding: 0 28px;
            position: sticky;
            top: 0;
            z-index: 200;
        }

        .tab-btn {
            padding: 14px 22px;
            border: none;
            background: none;
            color: var(--muted);
            font-size: 14px;
            font-weight: 700;
            font-family: inherit;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 7px;
        }

        .tab-btn:hover {
            color: var(--text);
        }

        .tab-btn.active-add {
            color: var(--accent);
            border-bottom-color: var(--accent);
        }

        .tab-btn.active-mul {
            color: var(--accent-mul);
            border-bottom-color: var(--accent-mul);
        }

        /* â”€â”€â”€ Control Panel â”€â”€â”€ */
        .control-panel {
            background: linear-gradient(135deg, var(--surface) 0%, var(--card) 100%);
            border-bottom: 1px solid var(--border);
            padding: 20px 28px 18px;
            display: flex;
            flex-wrap: wrap;
            gap: 18px;
            align-items: flex-end;
            position: sticky;
            top: 47px;
            z-index: 100;
            backdrop-filter: blur(12px);
        }

        .panel-hidden {
            display: none !important;
        }

        .panel-header {
            width: 100%;
            display: flex;
            align-items: baseline;
            gap: 14px;
            margin-bottom: 2px;
        }

        .panel-title {
            font-size: 20px;
            font-weight: 700;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .panel-title-add {
            background: linear-gradient(90deg, var(--accent), var(--accent3));
        }

        .panel-title-mul {
            background: linear-gradient(90deg, var(--accent-mul), var(--accent-mul2));
        }

        .panel-badge {
            font-size: 11px;
            color: var(--muted);
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .control-group label {
            font-size: 10px;
            font-weight: 700;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .control-group input[type="number"],
        .control-group input[type="text"] {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            color: var(--text);
            border-radius: 10px;
            padding: 7px 12px;
            font-size: 14px;
            font-family: inherit;
            width: 110px;
            outline: none;
            transition: border-color 0.2s;
        }

        .control-group input[type="text"] {
            width: 160px;
        }

        .control-group input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.15);
        }

        .per-page-badge {
            font-size: 11px;
            color: var(--accent3);
            background: rgba(76, 201, 240, 0.1);
            border: 1px solid rgba(76, 201, 240, 0.25);
            border-radius: 6px;
            padding: 3px 8px;
            white-space: nowrap;
            align-self: flex-end;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .checkbox-group label.group-label {
            font-size: 10px;
            font-weight: 700;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .checkbox-row {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid var(--border);
            border-radius: 7px;
            padding: 5px 9px;
            cursor: pointer;
            transition: all 0.15s;
            user-select: none;
        }

        .checkbox-item:hover {
            border-color: var(--accent);
            background: rgba(108, 99, 255, 0.1);
        }

        .checkbox-item input[type="checkbox"] {
            accent-color: var(--accent);
            width: 13px;
            height: 13px;
            cursor: pointer;
        }

        .checkbox-item span {
            font-size: 11px;
            color: var(--text);
            font-weight: 500;
        }

        /* Multiplication tab checkboxes â€” orange accent */
        .mul-checkbox .checkbox-item:hover {
            border-color: var(--accent-mul);
            background: rgba(247, 183, 49, 0.1);
        }

        .mul-checkbox .checkbox-item input[type="checkbox"] {
            accent-color: var(--accent-mul);
        }

        .mul-radio-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .mul-radio-group label.group-label {
            font-size: 10px;
            font-weight: 700;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .radio-row {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .radio-item {
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid var(--border);
            border-radius: 7px;
            padding: 5px 9px;
            cursor: pointer;
            transition: all 0.15s;
            user-select: none;
        }

        .radio-item:hover {
            border-color: var(--accent-mul);
            background: rgba(247, 183, 49, 0.1);
        }

        .radio-item input[type="radio"] {
            accent-color: var(--accent-mul);
            width: 13px;
            height: 13px;
            cursor: pointer;
        }

        .radio-item span {
            font-size: 11px;
            color: var(--text);
            font-weight: 500;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 7px;
            padding: 9px 20px;
            border-radius: 11px;
            border: none;
            cursor: pointer;
            font-size: 13px;
            font-weight: 700;
            font-family: inherit;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent), #9b59b6);
            color: #fff;
            box-shadow: 0 4px 18px rgba(108, 99, 255, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(108, 99, 255, 0.5);
        }

        .btn-primary-mul {
            background: linear-gradient(135deg, var(--accent-mul), var(--accent-mul2));
            color: #fff;
            box-shadow: 0 4px 18px rgba(247, 183, 49, 0.4);
        }

        .btn-primary-mul:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(247, 183, 49, 0.5);
        }

        .btn-print {
            background: linear-gradient(135deg, var(--green), #00b894);
            color: #fff;
            box-shadow: 0 4px 18px rgba(6, 214, 160, 0.4);
        }

        .btn-print:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(6, 214, 160, 0.5);
        }

        .btn-actions {
            display: flex;
            gap: 8px;
            align-items: flex-end;
        }

        /* â”€â”€â”€ Preview Area â”€â”€â”€ */
        .preview-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 24px;
            padding: 32px 24px 48px;
            background: #0a0a12;
            min-height: calc(100vh - 140px);
        }

        /* â”€â”€â”€ A4 Sheet â”€â”€â”€ */
        .a4-sheet {
            width: 210mm;
            height: 297mm;
            overflow: hidden;
            background: #fff;
            color: #111;
            border-radius: 3px;
            box-shadow: 0 6px 50px rgba(0, 0, 0, 0.65), 0 0 0 1px rgba(255, 255, 255, 0.04);
            padding: calc(var(--a4-pad-v) * 1mm) calc(var(--a4-pad-h) * 1mm);
            font-family: 'Nanum Gothic', 'Noto Sans KR', sans-serif;
            display: flex;
            flex-direction: column;
        }

        /* â”€â”€ Sheet Header â”€â”€ */
        .sheet-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            border-bottom: 2px solid #222;
            padding-bottom: 6px;
            margin-bottom: 8px;
            flex-shrink: 0;
        }

        .sheet-title {
            font-size: 18px;
            font-weight: 800;
            color: #111;
        }

        .sheet-meta {
            font-size: 10px;
            color: #555;
            text-align: right;
            line-height: 1.7;
        }

        .sheet-info-row {
            display: flex;
            gap: 20px;
            margin-bottom: 8px;
            font-size: 11px;
            color: #333;
            flex-shrink: 0;
        }

        .sheet-info-item {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .sheet-info-line {
            display: inline-block;
            width: 72px;
            border-bottom: 1px solid #666;
            margin-left: 3px;
        }

        /* â”€â”€ Problems Grid (ë§ì…ˆÂ·ëº„ì…ˆ) â”€â”€ */
        .problems-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px 10px;
            flex: 1;
            align-content: start;
        }

        .problem-item {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 7px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #fafafa;
            font-size: 18px;
            font-weight: 800;
            font-family: 'Nanum Gothic', sans-serif;
            height: calc(var(--row-h) * 1mm);
            overflow: hidden;
        }

        .problem-num {
            font-size: 8px;
            color: #bbb;
            font-weight: 400;
            min-width: 16px;
            align-self: flex-start;
            padding-top: 1px;
            flex-shrink: 0;
        }

        .problem-expr {
            display: flex;
            align-items: center;
            gap: 4px;
            flex-wrap: nowrap;
            flex: 1;
            overflow: hidden;
        }

        .blank-box {
            display: inline-block;
            width: 32px;
            height: 28px;
            border: 2.5px solid #1a1a1a;
            border-radius: 3px;
            background: #fff;
            flex-shrink: 0;
        }

        .op-symbol {
            font-size: 18px;
            font-weight: 900;
            color: #222;
            line-height: 1;
            flex-shrink: 0;
        }

        .eq-symbol {
            font-size: 16px;
            color: #444;
            flex-shrink: 0;
        }

        .no-problems {
            grid-column: 1 / -1;
            text-align: center;
            color: #aaa;
            font-size: 13px;
            padding: 30px 0;
        }

        /* â”€â”€ êµ¬êµ¬ë‹¨ Grid â”€â”€ */
        .mul-grid {
            display: grid;
            gap: 5px 8px;
            flex: 1;
            align-content: start;
        }

        /* 2-col layout for ë‹¨ë³„ ì„¸ë¡œ í‘œ */
        .mul-grid-2col {
            grid-template-columns: repeat(2, 1fr);
        }

        .mul-grid-3col {
            grid-template-columns: repeat(3, 1fr);
        }

        .mul-grid-4col {
            grid-template-columns: repeat(4, 1fr);
        }

        /* êµ¬êµ¬ë‹¨ ì¹´ë“œ: í•œ ë‹¨(æ®µ) ì „ì²´ */
        .mul-table-card {
            border: 1.5px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
            background: #fafafa;
        }

        .mul-table-title {
            background: #222;
            color: #fff;
            font-size: 11px;
            font-weight: 800;
            text-align: center;
            padding: 3px 0;
            letter-spacing: 0.05em;
        }

        .mul-row {
            display: flex;
            align-items: center;
            padding: 2px 7px;
            border-top: 1px solid #eee;
            font-size: 13px;
            font-weight: 800;
            font-family: 'Nanum Gothic', sans-serif;
            gap: 4px;
        }

        .mul-row:first-of-type {
            border-top: none;
        }

        .mul-blank {
            display: inline-block;
            width: 22px;
            height: 18px;
            border: 2px solid #1a1a1a;
            border-radius: 3px;
            background: #fff;
            flex-shrink: 0;
            vertical-align: middle;
        }

        .mul-eq {
            color: #444;
            margin: 0 2px;
            font-size: 12px;
        }

        .mul-op {
            font-weight: 900;
            color: #222;
            font-size: 13px;
        }

        /* â”€â”€ ì—°ìŠµë¬¸ì œ ìŠ¤íƒ€ì¼ (ì„ì¸ ë¬¸ì œ) â”€â”€ */
        .mul-practice-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px 10px;
            flex: 1;
            align-content: start;
        }

        /* â”€â”€â”€ Print Styles â”€â”€â”€ */
        @media print {
            @page {
                size: A4;
                margin: 0;
            }

            body,
            html {
                background: white !important;
            }

            .tab-bar,
            .control-panel {
                display: none !important;
            }

            .preview-area {
                padding: 0 !important;
                background: white !important;
                gap: 0 !important;
                min-height: unset;
                display: block !important;
            }

            .a4-sheet {
                box-shadow: none !important;
                border-radius: 0 !important;
                page-break-after: always;
                break-after: page;
            }

            .a4-sheet:last-child {
                page-break-after: avoid;
                break-after: avoid;
            }
        }
    </style>
</head>

<body>

    <!-- â”€â”€â”€ Tab Bar â”€â”€â”€ -->
    <div class="tab-bar">
        <button class="tab-btn active-add" id="tab-add" onclick="switchTab('add')">â• ë§ì…ˆÂ·ëº„ì…ˆ</button>
        <button class="tab-btn" id="tab-mul" onclick="switchTab('mul')">âœ–ï¸ êµ¬êµ¬ë‹¨</button>
    </div>

    <!-- â”€â”€â”€ Panel: ë§ì…ˆÂ·ëº„ì…ˆ â”€â”€â”€ -->
    <div class="control-panel" id="panel-add">
        <div class="panel-header">
            <span class="panel-title panel-title-add">âœï¸ ë§ì…ˆÂ·ëº„ì…ˆ í•™ìŠµì§€ ìƒì„±ê¸°</span>
            <span class="panel-badge">ì„¤ì • ë³€ê²½ ì‹œ ìë™ ì—…ë°ì´íŠ¸</span>
        </div>

        <div class="control-group">
            <label>ì²« ë²ˆì§¸ ìˆ˜ ìë¦¿ìˆ˜</label>
            <input type="number" id="digits1" value="1" min="1" max="4" />
        </div>
        <div class="control-group">
            <label>ë‘ ë²ˆì§¸ ìˆ˜ ìë¦¿ìˆ˜</label>
            <input type="number" id="digits2" value="1" min="1" max="4" />
        </div>

        <div class="control-group">
            <label>ì¥ ìˆ˜ (í˜ì´ì§€)</label>
            <input type="number" id="pageCount" value="1" min="1" max="20" />
        </div>

        <div class="per-page-badge" id="per-page-info">ì¥ë‹¹ â€” ë¬¸ì œ</div>

        <div class="checkbox-group">
            <label class="group-label">ë¬¸ì œ ìœ í˜•</label>
            <div class="checkbox-row">
                <label class="checkbox-item"><input type="checkbox" id="t1" checked /><span>â–¡ + â–¢ = ?</span></label>
                <label class="checkbox-item"><input type="checkbox" id="t2" checked /><span>â–¡ + ? = â–¢</span></label>
                <label class="checkbox-item"><input type="checkbox" id="t3" checked /><span>? + â–¡ = â–¢</span></label>
                <label class="checkbox-item"><input type="checkbox" id="t4" checked /><span>â–¡ - â–¢ = ?</span></label>
                <label class="checkbox-item"><input type="checkbox" id="t5" checked /><span>â–¡ - ? = â–¢</span></label>
                <label class="checkbox-item"><input type="checkbox" id="t6" checked /><span>? - â–¡ = â–¢</span></label>
            </div>
        </div>

        <div class="control-group">
            <label>í•™ìŠµì§€ ì œëª©</label>
            <input type="text" id="sheetTitle" value="ë§ì…ˆÂ·ëº„ì…ˆ í•™ìŠµì§€" />
        </div>

        <div class="control-group">
            <label>ì‹œì‘ ë²ˆí˜¸</label>
            <input type="number" id="sheetNoStart" value="1" min="1" max="999" />
        </div>

        <div class="btn-actions">
            <button class="btn btn-primary" onclick="generateAddSub()">ğŸ”„ ìƒˆë¡œ ìƒì„±</button>
            <button class="btn btn-print" onclick="window.print()">ğŸ–¨ï¸ í”„ë¦°íŠ¸</button>
        </div>
    </div>

    <!-- â”€â”€â”€ Panel: êµ¬êµ¬ë‹¨ â”€â”€â”€ -->
    <div class="control-panel panel-hidden" id="panel-mul">
        <div class="panel-header">
            <span class="panel-title panel-title-mul">âœ–ï¸ êµ¬êµ¬ë‹¨ í•™ìŠµì§€ ìƒì„±ê¸°</span>
            <span class="panel-badge">ì„¤ì • ë³€ê²½ ì‹œ ìë™ ì—…ë°ì´íŠ¸</span>
        </div>

        <!-- ë‹¨ ì„ íƒ -->
        <div class="checkbox-group mul-checkbox">
            <label class="group-label">ë‹¨ ì„ íƒ</label>
            <div class="checkbox-row" id="mul-dan-row">
                <!-- 2ë‹¨~9ë‹¨ ë™ì  ì‚½ì… -->
            </div>
        </div>

        <!-- ë¬¸ì œ í˜•ì‹ -->
        <div class="mul-radio-group">
            <label class="group-label">ë¬¸ì œ í˜•ì‹</label>
            <div class="radio-row">
                <label class="radio-item">
                    <input type="radio" name="mulStyle" value="table" />
                    <span>ë‹¨ë³„ í‘œ (ì„¸ë¡œ)</span>
                </label>
                <label class="radio-item">
                    <input type="radio" name="mulStyle" value="practice" checked />
                    <span>ì—°ìŠµë¬¸ì œ (ì„ìŒ)</span>
                </label>
            </div>
        </div>

        <!-- ë¹ˆì¹¸ ìœ„ì¹˜ (í‘œ ëª¨ë“œ: ë¼ë””ì˜¤) -->
        <div class="mul-radio-group" id="mul-blank-group" style="display:none">
            <label class="group-label">ë¹ˆì¹¸ ìœ„ì¹˜</label>
            <div class="radio-row">
                <label class="radio-item">
                    <input type="radio" name="mulBlank" value="answer" checked />
                    <span>â–¡ Ã— â–¡ = ?</span>
                </label>
                <label class="radio-item">
                    <input type="radio" name="mulBlank" value="multiplier" />
                    <span>â–¡ Ã— ? = â–¡</span>
                </label>
                <label class="radio-item">
                    <input type="radio" name="mulBlank" value="multiplicand" />
                    <span>? Ã— â–¡ = â–¡</span>
                </label>
                <label class="radio-item">
                    <input type="radio" name="mulBlank" value="mixed" />
                    <span>ì„ìŒ</span>
                </label>
            </div>
        </div>

        <!-- ë¹ˆì¹¸ ìœ„ì¹˜ (ì—°ìŠµë¬¸ì œ ëª¨ë“œ: ì²´í¬ë°•ìŠ¤) -->
        <div class="checkbox-group mul-checkbox" id="mul-practice-blank-group">
            <label class="group-label">ë¹ˆì¹¸ ìœ„ì¹˜ ì„ íƒ</label>
            <div class="checkbox-row">
                <label class="checkbox-item">
                    <input type="checkbox" id="pb-answer" checked />
                    <span>â–¡ Ã— â–¡ = ?</span>
                </label>
                <label class="checkbox-item">
                    <input type="checkbox" id="pb-multiplier" checked />
                    <span>â–¡ Ã— ? = â–¡</span>
                </label>
                <label class="checkbox-item">
                    <input type="checkbox" id="pb-multiplicand" checked />
                    <span>? Ã— â–¡ = â–¡</span>
                </label>
            </div>
        </div>

        <!-- ìˆœì„œ ì„ê¸° (í‘œ ëª¨ë“œ) -->
        <div class="checkbox-group" id="mul-shuffle-wrap" style="display:none">
            <label class="group-label">ìˆœì„œ</label>
            <div class="checkbox-row">
                <label class="checkbox-item mul-checkbox">
                    <input type="checkbox" id="mulShuffle" />
                    <span>1~9 ìˆœì„œ ì„ê¸°</span>
                </label>
            </div>
        </div>

        <!-- ì¥ ìˆ˜ -->
        <div class="control-group">
            <label>ì¥ ìˆ˜ (í˜ì´ì§€)</label>
            <input type="number" id="mulPageCount" value="1" min="1" max="20" />
        </div>

        <!-- ì œëª© -->
        <div class="control-group">
            <label>í•™ìŠµì§€ ì œëª©</label>
            <input type="text" id="mulSheetTitle" value="êµ¬êµ¬ë‹¨ í•™ìŠµì§€" style="width:160px" />
        </div>

        <!-- ì‹œì‘ ë²ˆí˜¸ -->
        <div class="control-group">
            <label>ì‹œì‘ ë²ˆí˜¸</label>
            <input type="number" id="mulSheetNoStart" value="1" min="1" max="999" />
        </div>

        <div class="btn-actions">
            <button class="btn btn-primary-mul" onclick="generateMul()">ğŸ”„ ìƒˆë¡œ ìƒì„±</button>
            <button class="btn btn-print" onclick="window.print()">ğŸ–¨ï¸ í”„ë¦°íŠ¸</button>
        </div>
    </div>

    <!-- â”€â”€â”€ Preview Area â”€â”€â”€ -->
    <div class="preview-area" id="preview-area">
        <!-- A4 sheets injected here -->
    </div>

    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //  Tab switching
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        let currentTab = 'add';

        function switchTab(tab) {
            currentTab = tab;
            document.getElementById('tab-add').className = 'tab-btn' + (tab === 'add' ? ' active-add' : '');
            document.getElementById('tab-mul').className = 'tab-btn' + (tab === 'mul' ? ' active-mul' : '');
            document.getElementById('panel-add').classList.toggle('panel-hidden', tab !== 'add');
            document.getElementById('panel-mul').classList.toggle('panel-hidden', tab !== 'mul');
            if (tab === 'add') generateAddSub();
            else generateMul();
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //  â”€â”€â”€ ë§ì…ˆÂ·ëº„ì…ˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const A4_H_MM = 297;
        const PAD_V_MM = 14;
        const HEADER_MM = 28;
        const ROW_H_MM = 14;
        const COLS = 3;
        const AVAIL_MM = A4_H_MM - PAD_V_MM * 2 - HEADER_MM;
        const ROWS_PER_PAGE = Math.floor(AVAIL_MM / ROW_H_MM);
        const PROBLEMS_PER_PAGE = ROWS_PER_PAGE * COLS;

        function getVal(id) { return parseInt(document.getElementById(id).value) || 0; }
        function getStr(id) { return document.getElementById(id).value || ''; }

        function randN(digits) {
            const min = digits === 1 ? 1 : Math.pow(10, digits - 1);
            const max = Math.pow(10, digits) - 1;
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function shuffleArray(arr) {
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
        }

        function safeSubtrahend(big, d2) {
            const lo = d2 === 1 ? 1 : Math.pow(10, d2 - 1);
            const hi = Math.min(big, Math.pow(10, d2) - 1);
            if (lo > hi) return Math.floor(Math.random() * big) + 1;
            return Math.floor(Math.random() * (hi - lo + 1)) + lo;
        }

        function makeProblem(type, d1, d2) {
            const box = '<span class="blank-box"></span>';
            const plus = '<span class="op-symbol">+</span>';
            const minus = '<span class="op-symbol">âˆ’</span>';
            const eq = '<span class="eq-symbol">=</span>';

            switch (type) {
                case 1: { const a = randN(d1), b = randN(d2); return `${a} ${plus} ${b} ${eq} ${box}`; }
                case 2: { const a = randN(d1), b = randN(d2); return `${a} ${plus} ${box} ${eq} ${a + b}`; }
                case 3: { const a = randN(d1), b = randN(d2); return `${box} ${plus} ${b} ${eq} ${a + b}`; }
                case 4: { const big = randN(d1); const b = safeSubtrahend(big, d2); return `${big} ${minus} ${b} ${eq} ${box}`; }
                case 5: { const big = randN(d1); const b = safeSubtrahend(big, d2); return `${big} ${minus} ${box} ${eq} ${big - b}`; }
                case 6: {
                    const b = randN(d2);
                    const lo = Math.max(d1 === 1 ? 1 : Math.pow(10, d1 - 1), b);
                    const hi = Math.pow(10, d1) - 1;
                    const q = lo <= hi ? Math.floor(Math.random() * (hi - lo + 1)) + lo : b + 1;
                    return `${box} ${minus} ${b} ${eq} ${q - b}`;
                }
                default: { const a = randN(d1), b = randN(d2); return `${a} ${plus} ${b} ${eq} ${box}`; }
            }
        }

        function escHtml(str) {
            return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        }

        function makeSheetShell(title, sheetNo, pageIndex) {
            const sheet = document.createElement('div');
            sheet.className = 'a4-sheet';
            const now = new Date();
            const dateStr = `${now.getFullYear()}.${String(now.getMonth() + 1).padStart(2, '0')}.${String(now.getDate()).padStart(2, '0')}`;
            sheet.innerHTML = `
        <div class="sheet-header">
          <div class="sheet-title">${escHtml(title)}</div>
          <div class="sheet-meta">No. ${sheetNo + pageIndex}<br/>${dateStr}</div>
        </div>
        <div class="sheet-info-row">
          <div class="sheet-info-item">ì´ë¦„<span class="sheet-info-line"></span></div>
          <div class="sheet-info-item">ë‚ ì§œ<span class="sheet-info-line"></span></div>
          <div class="sheet-info-item">ì ìˆ˜<span class="sheet-info-line"></span></div>
        </div>
      `;
            return sheet;
        }

        function buildAddSubSheet(pageIndex, startProblemNum, count, enabled, d1, d2, title, sheetNo) {
            const sheet = makeSheetShell(title, sheetNo, pageIndex);
            const grid = document.createElement('div');
            grid.className = 'problems-grid';
            sheet.appendChild(grid);

            if (enabled.length === 0) {
                grid.innerHTML = '<div class="no-problems">ë¬¸ì œ ìœ í˜•ì„ í•˜ë‚˜ ì´ìƒ ì„ íƒí•˜ì„¸ìš”.</div>';
                return sheet;
            }

            const problems = [];
            for (let i = 0; i < count; i++) problems.push({ type: enabled[i % enabled.length] });
            shuffleArray(problems);

            problems.forEach((p, i) => {
                const expr = makeProblem(p.type, d1, d2);
                const item = document.createElement('div');
                item.className = 'problem-item';
                item.innerHTML = `<span class="problem-num">${startProblemNum + i}</span><div class="problem-expr">${expr}</div>`;
                grid.appendChild(item);
            });

            return sheet;
        }

        function generateAddSub() {
            const d1 = Math.max(1, getVal('digits1'));
            const d2 = Math.max(1, getVal('digits2'));
            const pages = Math.max(1, getVal('pageCount'));
            const sheetNo = Math.max(1, getVal('sheetNoStart'));
            const title = getStr('sheetTitle') || 'ìˆ˜í•™ í•™ìŠµì§€';

            const enabled = [];
            for (let i = 1; i <= 6; i++) {
                if (document.getElementById('t' + i).checked) enabled.push(i);
            }

            document.getElementById('per-page-info').textContent =
                `ì¥ë‹¹ ${PROBLEMS_PER_PAGE}ë¬¸ì œ (${ROWS_PER_PAGE}í–‰ Ã— ${COLS}ì—´)`;

            const preview = document.getElementById('preview-area');
            preview.innerHTML = '';

            let counter = 1;
            for (let p = 0; p < pages; p++) {
                const sheet = buildAddSubSheet(p, counter, PROBLEMS_PER_PAGE, enabled, d1, d2, title, sheetNo);
                preview.appendChild(sheet);
                counter += PROBLEMS_PER_PAGE;
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //  â”€â”€â”€ êµ¬êµ¬ë‹¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        // Build dan checkboxes 2~9
        (function buildDanCheckboxes() {
            const row = document.getElementById('mul-dan-row');
            for (let d = 2; d <= 9; d++) {
                const lbl = document.createElement('label');
                lbl.className = 'checkbox-item';
                lbl.innerHTML = `<input type="checkbox" id="md${d}" checked /><span>${d}ë‹¨</span>`;
                row.appendChild(lbl);
            }
        })();

        function getSelectedDans() {
            const dans = [];
            for (let d = 2; d <= 9; d++) {
                if (document.getElementById('md' + d).checked) dans.push(d);
            }
            return dans;
        }

        function getMulStyle() {
            return document.querySelector('input[name="mulStyle"]:checked').value;
        }

        function getMulBlank() {
            return document.querySelector('input[name="mulBlank"]:checked').value;
        }

        // Build a single multiplication row HTML
        // blankPos: 'answer' | 'multiplier' | 'multiplicand'
        function mulRowHtml(n, k, blankPos) {
            const ans = n * k;
            const box = '<span class="mul-blank"></span>';
            const times = '<span class="mul-op">Ã—</span>';
            const eq = '<span class="mul-eq">=</span>';

            let lhs, rhs;
            if (blankPos === 'answer') {
                lhs = `${n} ${times} ${k}`; rhs = box;
            } else if (blankPos === 'multiplier') {
                lhs = `${n} ${times} ${box}`; rhs = ans;
            } else { // multiplicand
                lhs = `${box} ${times} ${k}`; rhs = ans;
            }
            return `<div class="mul-row">${lhs} ${eq} ${rhs}</div>`;
        }

        // choose blank position according to setting (supports 'mixed')
        function resolveBlankPos(i, setting) {
            if (setting === 'mixed') {
                const opts = ['answer', 'multiplier', 'multiplicand'];
                return opts[i % opts.length];
            }
            return setting;
        }

        // â”€â”€ ë‹¨ë³„ í‘œ ë ˆì´ì•„ì›ƒ â”€â”€
        // Returns a sheet DOM element
        function buildMulTableSheet(dans, pageIndex, title, sheetNo, doShuffle, blankSetting) {
            const sheet = makeSheetShell(title, sheetNo, pageIndex);
            const cols = dans.length <= 2 ? 2 : dans.length <= 3 ? 3 : 4;
            const grid = document.createElement('div');
            grid.className = `mul-grid mul-grid-${cols}col`;
            sheet.appendChild(grid);

            dans.forEach((n, idx) => {
                const card = document.createElement('div');
                card.className = 'mul-table-card';

                const titleDiv = document.createElement('div');
                titleDiv.className = 'mul-table-title';
                titleDiv.textContent = `${n}ë‹¨`;
                card.appendChild(titleDiv);

                let seq = [1, 2, 3, 4, 5, 6, 7, 8, 9];
                if (doShuffle) shuffleArray(seq);

                seq.forEach((k, i) => {
                    const blankPos = resolveBlankPos(i, blankSetting);
                    card.innerHTML += mulRowHtml(n, k, blankPos);
                });

                grid.appendChild(card);
            });

            return sheet;
        }

        // â”€â”€ ì—°ìŠµë¬¸ì œ(ì„ìŒ) ë ˆì´ì•„ì›ƒ â”€â”€
        function buildMulPracticeSheet(dans, pageIndex, startNum, count, title, sheetNo) {
            const sheet = makeSheetShell(title, sheetNo, pageIndex);
            const grid = document.createElement('div');
            grid.className = 'mul-practice-grid';
            sheet.appendChild(grid);

            if (dans.length === 0) {
                grid.innerHTML = '<div class="no-problems">ë‹¨ì„ í•˜ë‚˜ ì´ìƒ ì„ íƒí•˜ì„¸ìš”.</div>';
                return sheet;
            }

            // pool: all combinations from selected dans
            const pool = [];
            dans.forEach(n => {
                for (let k = 1; k <= 9; k++) pool.push({ n, k });
            });

            const problems = [];
            for (let i = 0; i < count; i++) problems.push(pool[Math.floor(Math.random() * pool.length)]);
            shuffleArray(problems);

            // blank position pool from checkboxes
            const blankOpts = [];
            if (document.getElementById('pb-answer').checked) blankOpts.push('answer');
            if (document.getElementById('pb-multiplier').checked) blankOpts.push('multiplier');
            if (document.getElementById('pb-multiplicand').checked) blankOpts.push('multiplicand');
            if (blankOpts.length === 0) blankOpts.push('answer'); // fallback
            problems.forEach((p, i) => {
                const blankPos = blankOpts[Math.floor(Math.random() * blankOpts.length)];
                const ans = p.n * p.k;
                const box = '<span class="blank-box"></span>';
                const times = '<span class="op-symbol">Ã—</span>';
                const eq = '<span class="eq-symbol">=</span>';

                let expr;
                if (blankPos === 'answer') {
                    expr = `${p.n} ${times} ${p.k} ${eq} ${box}`;
                } else if (blankPos === 'multiplier') {
                    expr = `${p.n} ${times} ${box} ${eq} ${ans}`;
                } else {
                    expr = `${box} ${times} ${p.k} ${eq} ${ans}`;
                }

                const item = document.createElement('div');
                item.className = 'problem-item';
                item.innerHTML = `<span class="problem-num">${startNum + i}</span><div class="problem-expr">${expr}</div>`;
                grid.appendChild(item);
            });

            return sheet;
        }

        function generateMul() {
            const dans = getSelectedDans();
            const style = getMulStyle();
            const blankSetting = getMulBlank();
            const doShuffle = document.getElementById('mulShuffle').checked;
            const pages = Math.max(1, getVal('mulPageCount'));
            const sheetNo = Math.max(1, getVal('mulSheetNoStart'));
            const title = getStr('mulSheetTitle') || 'êµ¬êµ¬ë‹¨ í•™ìŠµì§€';

            const preview = document.getElementById('preview-area');
            preview.innerHTML = '';

            if (style === 'table') {
                // Pack dans across pages: fit as many per page as looks good
                // Max cols = 4 â†’ max dans per page = 4; otherwise all on one page if â‰¤4
                const danGroupSize = dans.length <= 8 ? Math.ceil(dans.length / pages) : 4;
                let counter = 1;
                for (let p = 0; p < pages; p++) {
                    const slice = dans.slice(p * danGroupSize, (p + 1) * danGroupSize);
                    if (slice.length === 0) break;
                    const sheet = buildMulTableSheet(slice, p, title, sheetNo, doShuffle, blankSetting);
                    preview.appendChild(sheet);
                }
            } else {
                // Practice mode: same PROBLEMS_PER_PAGE
                let counter = 1;
                for (let p = 0; p < pages; p++) {
                    const sheet = buildMulPracticeSheet(dans, p, counter, PROBLEMS_PER_PAGE, title, sheetNo);
                    preview.appendChild(sheet);
                    counter += PROBLEMS_PER_PAGE;
                }
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //  Auto-update listeners
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        // ë§ì…ˆÂ·ëº„ì…ˆ
        ['digits1', 'digits2', 'pageCount', 'sheetNoStart', 'sheetTitle'].forEach(id => {
            document.getElementById(id).addEventListener('input', () => { if (currentTab === 'add') generateAddSub(); });
        });
        for (let i = 1; i <= 6; i++) {
            document.getElementById('t' + i).addEventListener('change', () => { if (currentTab === 'add') generateAddSub(); });
        }

        // êµ¬êµ¬ë‹¨
        for (let d = 2; d <= 9; d++) {
            document.getElementById('md' + d).addEventListener('change', () => { if (currentTab === 'mul') generateMul(); });
        }
        ['mulPageCount', 'mulSheetNoStart', 'mulSheetTitle'].forEach(id => {
            document.getElementById(id).addEventListener('input', () => { if (currentTab === 'mul') generateMul(); });
        });
        document.querySelectorAll('input[name="mulStyle"]').forEach(r => {
            r.addEventListener('change', () => {
                const isTable = document.querySelector('input[name="mulStyle"]:checked').value === 'table';
                document.getElementById('mul-blank-group').style.display = isTable ? '' : 'none';
                document.getElementById('mul-shuffle-wrap').style.display = isTable ? '' : 'none';
                document.getElementById('mul-practice-blank-group').style.display = isTable ? 'none' : '';
                if (currentTab === 'mul') generateMul();
            });
        });
        ['pb-answer', 'pb-multiplier', 'pb-multiplicand'].forEach(id => {
            document.getElementById(id).addEventListener('change', () => { if (currentTab === 'mul') generateMul(); });
        });
        document.querySelectorAll('input[name="mulBlank"]').forEach(r => {
            r.addEventListener('change', () => { if (currentTab === 'mul') generateMul(); });
        });
        document.getElementById('mulShuffle').addEventListener('change', () => { if (currentTab === 'mul') generateMul(); });

        // â”€â”€ Initial load â”€â”€
        generateAddSub();
    </script>
</body>

</html>